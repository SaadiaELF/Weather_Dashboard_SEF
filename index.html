<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Dashboard</title>
    <link rel="icon" type="image/png" href="Assets/icon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container-fluid">
        <header class="row-fluid" style="margin-bottom:10px">
            <nav class="navbar navbar-light border-bottom border-3 rounded-bottom" style="background-color: #d7eaf8;">
                <div class="container-fluid">
                    <a class="navbar-brand">
                        <img src="Assets/icon.png" alt="" width="30" height="24" class="d-inline-block align-top">
                        Weather Dashboard
                    </a>
                    <form class="d-flex">
                        <input id="searchInput" class="form-control me-2" type="search" placeholder="Search"
                            aria-label="Search">
                        <button id="searchBtn" class="btn btn-outline-primary" type="submit">Search</button>
                    </form>
                </div>
            </nav>
        </header>

        <main class="row" style="padding:0;">
            <div class="col-md-4">
                <div class="card float-start" style="width:100%;">
                    <div class="card-header">
                        Search history
                    </div>
                    <ul id="SearchHistory" class="list-group list-group-flush">
                        <!-- <button class="list-group-item"></button> -->
                    </ul>
                </div>
            </div>
            <div id="weatherCard" class="col-md-8" style="padding-left:0; display: none;">
                <div class="card float-end" style="width:100%">
                    <div class="card-body">
                        <h2 id="cityName" class="card-title"></h2>
                        <div id="cityForcast" class="card-text">
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <section class="col-md-8 float-end" style="margin-top:10px;">
            <h5>5-Days Forcast</h5>
            <div class="row row-cols-5">
                <div id="day01" class="col"></div>
                <div id="day02" class="col"></div>
                <div id="day03" class="col"></div>
                <div id="day04" class="col"></div>
                <div id="day05" class="col"></div>
            </div>
        </section>

        <footer class="row fixed-bottom bg-light border-top border-3 rounded-top" style="background-color: #d7eaf8;">
            <h6 class="text-center text-muted align-text-top"> SEF © Copyright </h6>
        </footer>

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"> </script>
    <script type="text/javascript">

        $(document).ready(function () {
            $("#searchBtn").on("click", function (event) {
                event.preventDefault();
                
                $("#weatherCard").attr("style", "block")
                var newCity = $("#searchInput").val().trim().toLowerCase();
                localStorage.setItem("City", newCity);
                var searchHistory = [];
                searchHistory.push();
                localStorage.setItem("History", JSON.stringify(searchHistory));

                var currentDate = moment().format('L');
                var APIKey = "050af8688da478cbcad8a4d3f154271f";
                var city = localStorage.getItem("City");
                var queryURL1 = "http://api.openweathermap.org/data/2.5/forecast?q=" + city + "&appid=" + APIKey;

                $.ajax({
                    url: queryURL1,
                    method: "GET"
                }).then(function (response) {
                    console.log(response)

                    $("#cityName").text(response.city.name + "  (" + currentDate + ")");

                    var K = response.list[0].main.temp;
                    console.log(K);
                    var F = (K - 273.15) * 1.80 + 32;
                    console.log(F.toFixed(2));

                    var humidity = response.list[0].main.humidity;
                    console.log(humidity);

                    var wind = response.list[0].wind.speed;
                    console.log(wind);

                    var cityName = response.city.name;
                    var newElt = $("<button>");
                    newElt.text(cityName);
                    newElt.addClass("list-group-item")
                    $("#SearchHistory").append(newElt);

                    var lat = response.city.coord.lat;
                    var lon = response.city.coord.lon;
                    var queryURL2 = "https://api.openweathermap.org/data/2.5/onecall?lat=" + lat + "&lon=" + lon + "&exclude=hourly,daily" + "&appid=" + APIKey;
                    $.ajax({
                        url: queryURL2,
                        method: "GET"
                    }).then(function (response) {
                        console.log(response)
                        var UVI = response.current.uvi;
                        console.log(UVI);
                        var forcast = $("#cityForcast").html(
                            "Temperature : " + F.toFixed(2) + " °F" + "<br>" +
                            "Humidity : " + humidity + " %" + "<br>" +
                            "Wind speed : " + wind + " MPH" + "<br>" +
                            "UV index : " + UVI
                        );
                    });


                });

            });


        });
    </script>

</body>

</html>